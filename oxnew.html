<!DOCTYPE html>
<html lang="ko" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>OX í€´ì¦ˆ ì°¸ì—¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 10px 20px -5px rgba(102, 126, 234, 0.4);
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(102, 126, 234, 0.5);
        }
        
        .btn-o {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.4);
        }
        
        .btn-x {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 10px 20px -5px rgba(239, 68, 68, 0.4);
        }
        
        .ox-display {
            font-size: min(50vw, 50vh);
            line-height: 0.85;
            font-weight: 800;
            filter: drop-shadow(0 4px 20px rgba(0,0,0,0.15));
        }
        
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-inactive {
            background: rgba(255, 255, 255, 0.7);
            color: #6b7280;
        }

        .frozen-overlay {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-6">
        <div class="card rounded-3xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2" translate="no">OX í€´ì¦ˆ ì°¸ì—¬</h1>
                <p class="text-gray-600" translate="no">ë¡œê·¸ì¸í•˜ì—¬ ì°¸ì—¬í•˜ì„¸ìš”</p>
            </div>
            
            <div id="loginForm">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2" translate="no">ì‚¬ë²ˆ</label>
                    <input type="text" id="employeeId" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì‚¬ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div id="newUserFields" class="hidden">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2" translate="no">ì„±ëª…</label>
                        <input type="text" id="userName" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì„±ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2" translate="no">ì§ìœ„</label>
                        <input type="text" id="userPosition" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="ì§ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                </div>
                
                <button onclick="handleLogin()" class="btn-primary w-full py-3 text-white rounded-xl font-semibold transform hover:-translate-y-1" translate="no">
                    ë¡œê·¸ì¸
                </button>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± í™”ë©´ -->
    <div id="mainApp" class="hidden min-h-screen flex flex-col">
        <!-- í—¤ë” -->
        <div class="header-gradient">
            <div class="flex justify-between items-center px-6 py-4">
                <div>
                    <h1 class="text-2xl font-bold text-white" translate="no">OX Quiz</h1>
                    <p class="text-white text-opacity-70 text-sm" id="userInfo" translate="no"></p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg text-white px-4 py-2 rounded-full font-bold text-lg border border-white border-opacity-30" translate="no">
                        ì ìˆ˜: <span id="userScore">0</span>
                    </div>
                    <button onclick="logout()" class="text-white text-opacity-70 hover:text-white text-sm" translate="no">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>
            
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="flex px-6 pb-4">
                <button onclick="switchTab('quiz')" id="quizTab" class="tab-active px-6 py-2 rounded-l-xl font-medium transition-all" translate="no">
                    í€´ì¦ˆ
                </button>
                <button onclick="switchTab('ranking')" id="rankingTab" class="tab-inactive px-6 py-2 rounded-r-xl font-medium transition-all" translate="no">
                    ë­í‚¹
                </button>
            </div>
        </div>

        <!-- ë™ê²° ìƒíƒœ ì•Œë¦¼ -->
        <div id="frozenAlert" class="hidden mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-xl">
            <div class="flex items-center">
                <div class="text-red-600 text-xl mr-3">ğŸš«</div>
                <div class="text-red-800 font-medium" translate="no">ê³„ì •ì´ ë™ê²°ë˜ì–´ í€´ì¦ˆ ì°¸ì—¬ê°€ ì œí•œë©ë‹ˆë‹¤.</div>
            </div>
        </div>

        <!-- í€´ì¦ˆ íƒ­ -->
        <div id="quizContent" class="flex-1 flex flex-col">
            <!-- ë©”ì¸ ë””ìŠ¤í”Œë ˆì´ ì˜ì—­ -->
            <div class="flex-1 flex items-center justify-center p-6">
                <div class="card rounded-3xl w-full max-w-2xl mx-auto py-12 px-6" id="quizCard">
                    <div id="quizDisplay" class="text-center text-gray-400">
                        <div class="text-6xl mb-6 opacity-60">â°</div>
                        <div class="text-xl font-semibold opacity-80" translate="no">ê²Œì„ ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...</div>
                    </div>
                </div>
            </div>

            <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
            <div class="card m-6 rounded-3xl p-6" id="controlPanel">
                <div id="quizControls">
                    <!-- OX ì„ íƒ ë²„íŠ¼ -->
                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <button id="btnO" onclick="selectAnswer('O')" disabled
                                class="h-16 text-3xl font-bold text-white rounded-2xl transition-all duration-300 bg-gray-400 cursor-not-allowed">
                            O
                        </button>
                        <button id="btnX" onclick="selectAnswer('X')" disabled
                                class="h-16 text-3xl font-bold text-white rounded-2xl transition-all duration-300 bg-gray-400 cursor-not-allowed">
                            X
                        </button>
                    </div>

                    <!-- ìƒíƒœ í‘œì‹œ -->
                    <div class="text-center">
                        <div id="quizStatus" class="text-lg font-medium text-gray-600" translate="no">
                            ê²Œì„ ì‹œì‘ ëŒ€ê¸° ì¤‘...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë­í‚¹ íƒ­ -->
        <div id="rankingContent" class="hidden flex-1 p-6">
            <div class="card rounded-3xl w-full max-w-4xl mx-auto p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center" translate="no">ì‹¤ì‹œê°„ ë­í‚¹</h2>
                <div id="rankingList" class="space-y-3">
                    <div class="text-center text-gray-500 py-8" translate="no">ë­í‚¹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc, 
            onSnapshot, 
            collection, 
            query, 
            orderBy, 
            updateDoc,
            serverTimestamp,
            where
        } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA_SuKTn4jWyBL3lyk8CK6hPpttpR0MOMc",
            authDomain: "quizland-hyogi.firebaseapp.com",
            projectId: "quizland-hyogi",
            storageBucket: "quizland-hyogi.firebasestorage.app",
            messagingSenderId: "886372179569",
            appId: "1:886372179569:web:8616d019f7b63a26e045d0"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let currentQuestion = null;
        let selectedAnswer = null;
        let hasAnswered = false;
        let unsubscribeListeners = [];

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        window.handleLogin = async function() {
            const employeeId = document.getElementById('employeeId').value.trim();
            if (!employeeId) {
                alert('ì‚¬ë²ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const userDoc = await getDoc(doc(db, 'users', employeeId));
                
                if (userDoc.exists()) {
                    // ê¸°ì¡´ ì‚¬ìš©ì
                    currentUser = { id: employeeId, ...userDoc.data() };
                    await updateDoc(doc(db, 'users', employeeId), {
                        lastLogin: serverTimestamp(),
                        isOnline: true
                    });
                    showMainApp();
                } else {
                    // ì‹ ê·œ ì‚¬ìš©ì
                    const userName = document.getElementById('userName').value.trim();
                    const userPosition = document.getElementById('userPosition').value.trim();
                    
                    if (!userName || !userPosition) {
                        document.getElementById('newUserFields').classList.remove('hidden');
                        return;
                    }
                    
                    const newUser = {
                        name: userName,
                        position: userPosition,
                        score: 0,
                        joinedAt: serverTimestamp(),
                        lastLogin: serverTimestamp(),
                        isActive: true,
                        isFrozen: false,
                        isOnline: true
                    };
                    
                    await setDoc(doc(db, 'users', employeeId), newUser);
                    currentUser = { id: employeeId, ...newUser, score: 0 };
                    showMainApp();
                }
            } catch (error) {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        };

        // ë©”ì¸ ì•± í‘œì‹œ
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userInfo').textContent = `${currentUser.name} (${currentUser.position})`;
            document.getElementById('userScore').textContent = currentUser.score || 0;
            
            setupListeners();
        }

        // ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupListeners() {
            console.log('ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘');
            
            // í˜„ì¬ ë¬¸ì œ ë¦¬ìŠ¤ë„ˆ (ê°€ì¥ ì¤‘ìš”)
            const questionListener = onSnapshot(doc(db, 'system', 'currentQuestion'), (doc) => {
                console.log('ë¬¸ì œ ë¦¬ìŠ¤ë„ˆ íŠ¸ë¦¬ê±°:', doc.exists());
                if (doc.exists()) {
                    currentQuestion = doc.data();
                    console.log('í˜„ì¬ ë¬¸ì œ:', currentQuestion);
                    updateQuizDisplay();
                } else {
                    currentQuestion = null;
                    console.log('ë¬¸ì œ ì—†ìŒ');
                    showWaitingState();
                }
            }, (error) => {
                console.error('ë¬¸ì œ ë¦¬ìŠ¤ë„ˆ ì˜¤ë¥˜:', error);
            });
            unsubscribeListeners.push(questionListener);

            // ì‚¬ìš©ì ì •ë³´ ë¦¬ìŠ¤ë„ˆ (ì ìˆ˜, ë™ê²° ìƒíƒœ ë“±)
            const userListener = onSnapshot(doc(db, 'users', currentUser.id), (doc) => {
                if (doc.exists()) {
                    const userData = doc.data();
                    currentUser = { ...currentUser, ...userData };
                    document.getElementById('userScore').textContent = userData.score || 0;
                    
                    // ë™ê²° ìƒíƒœ ì²˜ë¦¬
                    if (userData.isFrozen) {
                        showFrozenState();
                    } else {
                        hideFrozenState();
                    }
                }
            });
            unsubscribeListeners.push(userListener);

            // ë­í‚¹ ë¦¬ìŠ¤ë„ˆ
            const rankingListener = onSnapshot(
                query(collection(db, 'users'), where('isActive', '==', true), orderBy('score', 'desc')), 
                (snapshot) => {
                    updateRanking(snapshot);
                }
            );
            unsubscribeListeners.push(rankingListener);
        }

        // ëŒ€ê¸° ìƒíƒœ í‘œì‹œ
        function showWaitingState() {
            const display = document.getElementById('quizDisplay');
            const status = document.getElementById('quizStatus');
            
            display.innerHTML = '<div class="text-6xl mb-6 opacity-60">â°</div><div class="text-xl font-semibold opacity-80" translate="no">ê²Œì„ ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤...</div>';
            status.textContent = 'ê²Œì„ ì‹œì‘ ëŒ€ê¸° ì¤‘...';
            resetButtons();
            hasAnswered = false;
            selectedAnswer = null;
        }

        // í€´ì¦ˆ í™”ë©´ ì—…ë°ì´íŠ¸
        function updateQuizDisplay() {
            if (!currentQuestion) {
                showWaitingState();
                return;
            }

            console.log('í€´ì¦ˆ í™”ë©´ ì—…ë°ì´íŠ¸:', currentQuestion.status);
            
            const display = document.getElementById('quizDisplay');
            const status = document.getElementById('quizStatus');

            if (currentQuestion.status === 'active' && !hasAnswered && !currentUser.isFrozen) {
                // ë¬¸ì œ í™œì„± ìƒíƒœ - ë‹µë³€ ê°€ëŠ¥
                const bonusText = currentQuestion.isBonus ? '<div class="text-lg text-orange-500 font-bold mt-2" translate="no">â­ ë³´ë„ˆìŠ¤ ë¬¸ì œ (2ë°° ì ìˆ˜)</div>' : '';
                display.innerHTML = `
                    <div class="text-xl text-gray-600 mb-4" translate="no">${currentQuestion.title}</div>
                    ${bonusText}
                `;
                status.textContent = 'O ë˜ëŠ” Xë¥¼ ì„ íƒí•˜ì„¸ìš”';
                enableButtons();
            } else if (currentQuestion.status === 'active' && hasAnswered) {
                // ë‹µë³€ ì™„ë£Œ ìƒíƒœ
                const color = selectedAnswer === 'O' ? 'text-blue-500' : 'text-red-500';
                display.innerHTML = `
                    <div class="text-center w-full">
                        <div class="ox-display ${color}">${selectedAnswer}</div>
                        <div class="text-lg text-gray-500 mt-4 loading" translate="no">ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
                    </div>
                `;
                status.textContent = 'ë‹µë³€ì„ ì œì¶œí–ˆìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...';
                disableButtons();
            } else if (currentQuestion.status === 'ended') {
                // ë¬¸ì œ ì¢…ë£Œ ìƒíƒœ
                showQuestionResult();
            } else {
                // ê¸°íƒ€ ìƒíƒœ
                showWaitingState();
            }
        }

        // ë¬¸ì œ ê²°ê³¼ í‘œì‹œ
        function showQuestionResult() {
            const display = document.getElementById('quizDisplay');
            const status = document.getElementById('quizStatus');
            
            if (hasAnswered) {
                const isCorrect = selectedAnswer === currentQuestion.correctAnswer;
                const resultText = isCorrect ? 'âœ“ ì •ë‹µì…ë‹ˆë‹¤!' : 'âœ— ì˜¤ë‹µì…ë‹ˆë‹¤.';
                const resultColor = isCorrect ? 'text-green-500' : 'text-red-500';
                
                display.innerHTML = `
                    <div class="text-center">
                        <div class="${resultColor} text-3xl font-bold mb-4">${resultText}</div>
                        <div class="text-xl text-gray-600 mb-2" translate="no">ì •ë‹µ: ${currentQuestion.correctAnswer}</div>
                        <div class="text-lg text-gray-500" translate="no">ë‹¤ìŒ ë¬¸ì œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
                    </div>
                `;
                status.textContent = 'ë¬¸ì œê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤';
            } else {
                display.innerHTML = `
                    <div class="text-center">
                        <div class="text-gray-500 text-2xl font-bold mb-4">ì‹œê°„ ì´ˆê³¼</div>
                        <div class="text-xl text-gray-600 mb-2" translate="no">ì •ë‹µ: ${currentQuestion.correctAnswer}</div>
                        <div class="text-lg text-gray-500" translate="no">ë‹¤ìŒ ë¬¸ì œë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
                    </div>
                `;
                status.textContent = 'ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤';
            }
            
            disableButtons();
            
            // ë‹¤ìŒ ë¬¸ì œë¥¼ ìœ„í•´ ìƒíƒœ ì´ˆê¸°í™”
            setTimeout(() => {
                hasAnswered = false;
                selectedAnswer = null;
            }, 2000);
        }

        // ë‹µë³€ ì„ íƒ
        window.selectAnswer = async function(answer) {
            if (!currentQuestion || currentQuestion.status !== 'active' || hasAnswered || currentUser.isFrozen) {
                return;
            }

            selectedAnswer = answer;
            hasAnswered = true;

            console.log('ë‹µë³€ ì„ íƒ:', answer);

            // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            updateQuizDisplay();

            // Firestoreì— ë‹µë³€ ì €ì¥
            try {
                await setDoc(doc(db, 'answers', `${currentQuestion.id}_${currentUser.id}`), {
                    userId: currentUser.id,
                    userName: currentUser.name,
                    userPosition: currentUser.position,
                    answer: answer,
                    questionId: currentQuestion.id,
                    questionNumber: currentQuestion.number,
                    timestamp: serverTimestamp()
                });
                console.log('ë‹µë³€ ì €ì¥ ì™„ë£Œ');
            } catch (error) {
                console.error('ë‹µë³€ ì €ì¥ ì˜¤ë¥˜:', error);
            }
        };

        // ë²„íŠ¼ í™œì„±í™”
        function enableButtons() {
            const btnO = document.getElementById('btnO');
            const btnX = document.getElementById('btnX');
            
            btnO.disabled = false;
            btnX.disabled = false;
            btnO.className = 'btn-o h-16 text-3xl font-bold text-white rounded-2xl transition-all duration-300 transform hover:-translate-y-1';
            btnX.className = 'btn-x h-16 text-3xl font-bold text-white rounded-2xl transition-all duration-300 transform hover:-translate-y-1';
        }

        // ë²„íŠ¼ ì´ˆê¸°í™”
        function resetButtons() {
            const btnO = document.getElementById('btnO');
            const btnX = document.getElementById('btnX');
            
            btnO.disabled = true;
            btnX.disabled = true;
            btnO.className = 'h-16 text-3xl font-bold text-white rounded-2xl transition-all duration-300 bg-gray-400 cursor-not-allowed';
            btnX.className = 'h-16 text-3xl font-bold text-white rounded-2xl transition-all duration-300 bg-gray-400 cursor-not-allowed';
        }

        // ë²„íŠ¼ ë¹„í™œì„±í™”
        function disableButtons() {
            document.getElementById('btnO').disabled = true;
            document.getElementById('btnX').disabled = true;
        }

        // ë™ê²° ìƒíƒœ í‘œì‹œ
        function showFrozenState() {
            document.getElementById('frozenAlert').classList.remove('hidden');
            document.getElementById('quizCard').classList.add('frozen-overlay');
            document.getElementById('controlPanel').classList.add('frozen-overlay');
            resetButtons();
        }

        // ë™ê²° ìƒíƒœ í•´ì œ
        function hideFrozenState() {
            document.getElementById('frozenAlert').classList.add('hidden');
            document.getElementById('quizCard').classList.remove('frozen-overlay');
            document.getElementById('controlPanel').classList.remove('frozen-overlay');
        }

        // íƒ­ ì „í™˜
        window.switchTab = function(tab) {
            if (tab === 'quiz') {
                document.getElementById('quizContent').classList.remove('hidden');
                document.getElementById('rankingContent').classList.add('hidden');
                document.getElementById('quizTab').className = 'tab-active px-6 py-2 rounded-l-xl font-medium transition-all';
                document.getElementById('rankingTab').className = 'tab-inactive px-6 py-2 rounded-r-xl font-medium transition-all';
            } else {
                document.getElementById('quizContent').classList.add('hidden');
                document.getElementById('rankingContent').classList.remove('hidden');
                document.getElementById('quizTab').className = 'tab-inactive px-6 py-2 rounded-l-xl font-medium transition-all';
                document.getElementById('rankingTab').className = 'tab-active px-6 py-2 rounded-r-xl font-medium transition-all';
            }
        };

        // ë­í‚¹ ì—…ë°ì´íŠ¸
        function updateRanking(snapshot) {
            const rankingList = document.getElementById('rankingList');
            const users = [];
            
            snapshot.forEach((doc) => {
                const userData = doc.data();
                users.push({ id: doc.id, ...userData });
            });

            if (users.length === 0) {
                rankingList.innerHTML = '<div class="text-center text-gray-500 py-8" translate="no">ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            let html = '';
            users.forEach((user, index) => {
                const isCurrentUser = user.id === currentUser?.id;
                const rankClass = index < 3 ? 'bg-gradient-to-r from-yellow-100 to-yellow-50 border-yellow-200' : 'bg-white border-gray-200';
                const textClass = isCurrentUser ? 'font-bold text-blue-600' : 'text-gray-800';
                const statusIcon = user.isFrozen ? 'ğŸš«' : (user.isOnline ? 'ğŸŸ¢' : 'âšª');
                
                html += `
                    <div class="flex items-center justify-between p-4 rounded-xl border ${rankClass}">
                        <div class="flex items-center space-x-4">
                            <div class="text-2xl font-bold ${textClass}">${index + 1}</div>
                            <div>
                                <div class="${textClass} font-medium flex items-center">
                                    ${user.name} ${statusIcon}
                                </div>
                                <div class="text-sm text-gray-500">${user.position}</div>
                            </div>
                        </div>
                        <div class="text-2xl font-bold ${textClass}">${user.score || 0}ì </div>
                    </div>
                `;
            });
            
            rankingList.innerHTML = html;
        }

        // ë¡œê·¸ì•„ì›ƒ
        window.logout = async function() {
            if (currentUser) {
                try {
                    await updateDoc(doc(db, 'users', currentUser.id), {
                        isOnline: false
                    });
                } catch (error) {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                }
            }

            // ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
            unsubscribeListeners.forEach(unsubscribe => unsubscribe());
            unsubscribeListeners = [];
            
            // ë³€ìˆ˜ ì´ˆê¸°í™”
            currentUser = null;
            currentQuestion = null;
            selectedAnswer = null;
            hasAnswered = false;
            
            // í™”ë©´ ì´ˆê¸°í™”
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('newUserFields').classList.add('hidden');
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('employeeId').value = '';
            document.getElementById('userName').value = '';
            document.getElementById('userPosition').value = '';
        };

        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ì˜¨ë¼ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        window.addEventListener('beforeunload', () => {
            if (currentUser) {
                navigator.sendBeacon('/api/offline', JSON.stringify({userId: currentUser.id}));
            }
        });

        // Enter í‚¤ë¡œ ë¡œê·¸ì¸
        document.getElementById('employeeId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });
    </script>
</body>
</html>
